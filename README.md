arch-ros-stacks
---------------

This is a fork of [zootboy][zootboy]'s fork of [hauptmech][hauptmech]'s fork of
[moesenle][moesenle]'s very nice arch-ros-stacks.

I am currently maintaining Indigo/Jade packages for Arch Linux. I also accept
pull requests for Groovy and Hydro packages (that I no longer maintain).

Please e-mail me with any suggestions, comments or package requests for
Indigo/Jade:

\<chretien+aur at lirmm dot fr\>

## How it works

Since the AUR now stores PKGBUILDs as Git repositories, each ROS package is
handled as a Git submodule (except some older packages). Such packages contain
two files:

* a `PKGBUILD` script that details the dependencies, versions, how to compile
  the package etc. This file is automatically generated by a Python script.
* a `.SRCINFO` file required for the AUR upload. This file is generated with
  `mksrcinfo`.

Once these files are generated, they simply need to be commited and pushed
to the AUR, so that every Arch user can install the package with his
favorite AUR helper.

## How to contribute

If you want to contribute, simply fork this repository, create or update some
packages, push these packages to the AUR, and make a pull request afterwards.

### PKGBUILD creation and update

The script that automates most of the work is `import_catkin_packages.py`
available in `dependencies/ros-build-tools`.

Note that the default behavior is to fetch release information from the
[official rosdistro distribution.yaml][distribution.yaml].

#### Miscellaneous features

To list the options:
```shell
$ python2 import_catkin_packages.py --help
```

To list all available Indigo packages:

```shell
$ python2 import_catkin_packages.py --distro=indigo --list | less
```

You can also provide the output directory when listing packages, in order to
see the ones that have not been generated yet:

```shell
$ python2 import_catkin_packages.py --distro=indigo --output-directory=/path/to/arch-ros-stacks/indigo --list | less
```

The Python version can also be chosen:
```shell
$ python2 import_catkin_packages.py --python-version=2.7 --distro=indigo --output-directory=...
```

#### PKGBUILD creation

To add a new official package called `package_foo` recursively:

```shell
$ python2 import_catkin_packages.py --distro=indigo --output-directory=/path/to/arch-ros-stacks/indigo -r package_foo
```

**WARNING**: packages created that way will be treated as submodules. If the
remote repository is empty (e.g. new AUR package), a post-processing step is
required since a commit id is expected to proprely register the submodule.
After doing the first commit of the package, run `new_submodule.sh` on the
submodule. This may be solved automatically later on.

#### PKGBUILD update

To simply update `package_foo`:

```shell
$ python2 import_catkin_packages.py --distro=indigo --output-directory=/path/to/arch-ros-stacks/indigo -u package_foo
```

To recursively "force update" `package_foo`:

```shell
$ python2 import_catkin_packages.py --distro=indigo --output-directory=/path/to/arch-ros-stacks/indigo -rfu package_foo
```

#### AUR upload

PKGBUILDs are no longer explicitly handled in this repository. Instead, new
packages are submodules pointing to the AUR. Thus, updating the AUR package is
as simple as pushing a Git repositories. For this, you will need to create an
account on the [AUR][AUR] (that way, you will also be able to report errors to
package maintainers), and [register an SSH key][AUR key].

Before uploading anything, you need to make sure that the `.SRCINFO` file of
the package is up-to-date, which can be done by running `mksrcinfo`.

Thus, the typical workflow once the PKGBUILD has been updated is:

```shell
# Update .SRCINFO
$ mksrcinfo
# Review changes
$ git add -p .
# Commit
$ git commit -m "Update to version ..."
# If this is a new package, run new_submodule.sh to properly register the submodule:
# $ ./new_submodule.sh indigo/foo
# Push to the AUR
$ git push origin master
```

#### Conversion to AUR4 packages (legacy)

The `to_aur4.sh` script can take care of uploading packages that are not
submodules to the AUR. Since it works by creating a subtree of a specific
package from `arch-ros-stacks`, applying `mksrcinfo` to create the required
`.SRCINFO` file, and pushing the result to the AUR, it will only work if all
pushes to the AUR of this specific package were done using it.

Recent versions of `import_catkin_packages.py` create/pull AUR submodules, so
this is no longer required.


### Python version

Starting with Indigo, Python 3 support is added to ROS. However, since most
non-core packages are not Python 3 ready yet, we will continue using Python 2
for Indigo and Jade.

[zootboy]: https://github.com/zootboy/arch-ros-stacks
[hauptmech]: https://github.com/hauptmech/arch-ros-stacks
[moesenle]: https://github.com/moesenle/arch-ros-stacks
[distribution.yaml]: https://github.com/ros/rosdistro/blob/master/indigo/distribution.yaml
[AUR]: https://aur.archlinux.org/
[AUR key]: https://wiki.archlinux.org/index.php/Arch_User_Repository#Submitting_packages
